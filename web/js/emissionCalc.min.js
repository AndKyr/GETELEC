const bounds={field:{min:.5,max:20},radius:{min:.5,max:995},workFunction:{min:0,max:100},temperature:{min:10,max:3e3}};function main(){let e=io(),t,n,a,r,i,l,o,s,d,m,u,c,p,_,g,f,h,y,b,E,k,I,v,x,B,w,V,D,P,W,A,F,M,T,S;function C(){errorDivs.length>0&&(errorDivs.forEach(e=>{e.remove()}),errorDivs=[]),t=document.getElementById("pickMaterialType").value,A=document.getElementById("pickChangingVar").value,n=document.getElementById("field_in").value,a=document.getElementById("radius_in").value,r=document.getElementById("wf_in").value,i=document.getElementById("temperature_in").value,l=document.getElementById("field_mult_in").value,o=document.getElementById("radius_mult_in").value,s=document.getElementById("wf_mult_in").value,d=document.getElementById("temperature_mult_in").value,p=document.getElementById("gammaMetalParam").value,_=document.getElementById("gammaSemiParam").value,g=document.getElementById("ecParam").value,f=document.getElementById("efParam").value,h=document.getElementById("egParam").value,y=document.getElementById("meParam").value,b=document.getElementById("mpParam").value,c=document.getElementById("chooseEC").checked,u=document.getElementById("chooseES").checked,m=document.getElementById("chooseNH").checked,""==n&&(n="10"),""==a&&(a="50"),""==p&&(p="10"),""==_&&(_="10"),""==r&&(r="4.5"),""==i&&(i="300"),""==g&&(g="4.05"),""==f&&(f="4.61"),""==h&&(h="1.12"),""==y&&(y="0.98"),""==b&&(b="0.5"),E=processDataInput(n),k=processDataInput(a),P=processDataInput(p),W=processDataInput(_),I=processDataInput(r),v=processDataInput(i),x=processDataInput(g),B=processDataInput(f),w=processDataInput(h),V=processDataInput(y),D=processDataInput(b),c=c?1:0,u=u?1:0,m=m?1:0,function(){for(let e=0;e<E.length;e++)E[e]=E[e]*l;for(let t=0;t<k.length;t++)k[t]=k[t]*o;for(let n=0;n<I.length;n++)I[n]=I[n]*s;for(let a=0;a<v.length;a++)v[a]=v[a]*d}(),function(){if("string"==typeof A)switch(A){case"1":A=2;break;case"2":A=3;break;case"4":A=4;break;case"5":A=5}}(),function(){if("string"==typeof t)switch(t){case"1":t=1;break;case"2":t=2}}(),F=[[t],[A],E,k,I,v,x,B,w,P,W,V,D,[c],[m],[u]],function(){if(!1==c&&!1==u&&!1==m)return addErrorDiv("Please select what do You want to compute, ie. Emitted Current, Nottigham Heat or Electron spectrum"),!1;if(F[A].length>=3){for(let e=2;e<5;e++)if(e!=A){if(!(F[e].length>1))return!0;addErrorDiv("Only sweeping parameter accepts multiple values");break}}else addErrorDiv("Sweeping parameter must have at least 3 values");return!1}()&&(e.emit("calculateEmission",F),console.log(F),$("#loadingModal").modal("show"))}let z,R,K,L,G,N,O;z=document.getElementById("enterButton"),R=document.getElementById("autoGenerateValuesToggle"),K=document.getElementById("generateValuesButton"),L=document.getElementById("pickMaterialType"),G=document.getElementById("advancedModeToggle"),document.getElementById("advancedModeToggleMainDiv"),N=document.getElementById("pickChangingVar"),O=document.getElementById("preselectSemiProperties"),z.addEventListener("click",C),R.addEventListener("change",updateAutoGenerateValuesDiv),K.addEventListener("click",autoGenerateValues),L.addEventListener("change",updateWFName),G.addEventListener("change",updateAdvancedMethods),N.addEventListener("change",updatePropertiesPresets),O.addEventListener("change",updatePreselectSemiProperties),z.addEventListener("click",C),updatePropertiesPresets(),!function(){let e=document.getElementById("currentChart"),t=document.getElementById("heatChart"),n=document.getElementById("spectrumChart"),a=[{x:.10207040421489234,y:5617.000000000002},{x:.10559087321846734,y:4214.878587327415},{x:.10911134222204238,y:3164.722642398102},{x:.1126318112256174,y:2377.5417614456496},{x:.11615228022919243,y:1787.0286368310246},{x:.11967274923276744,y:1343.742827965096},{x:.21120494332571796,y:.8305729972325626}];M=new Chart(e,{type:"line",data:{datasets:[{label:"emitted current",data:a,backgroundColor:["rgba(255, 99, 132, 0.2)"],borderColor:["rgba(255, 99, 132, 1)"],borderWidth:1,interpolate:!0}]},options:{fill:!1,lineTension:.1,scales:{y:{title:{display:!0,text:"Emitted current density",font:{size:18}},type:"logarithmic",position:"bottom",ticks:{callback:function(e,t,n){return 1e6===e?"1 [MA/nm^2]":1e5===e?"100 [kA/nm^2]":1e4===e?"10 [kA/nm^2]":1e3===e?"1 [kA/nm^2]":100===e?"100 [A/nm^2]":10===e?"10 [A/nm^2]":1===e?"1 [A/nm^2]":.1===e?"100 [mA/nm^2]":.01===e?"10 [mA/nm^2]":.001===e?"1 [mA/nm^2]":1e-4===e?"0.1 [mA/nm^2]":1e-5===e?"0.01 [mA/nm^2]":1e-6===e?"1000 [nA/nm^2]":1e-7===e?"100 [nA/nm^2]":1e-8===e?"10 [nA/nm^2]":1e-9===e?"1 [nA/nm^2]":1e-10===e?"100 [pA/nm^2]":1e-11===e?"10 [pA/nm^2]":1e-12===e?"1 [pA/nm^2]":1e-13===e?"100 [fA/nm^2]":1e-14===e?"10 [fA/nm^2]":1e-15===e?"1 [fA/nm^2]":null}}},x:{title:{text:"Sweeping parameter",display:!0,font:{size:18}},type:"linear",position:"bottom",ticks:{callback:function(e,t,n){return String(e).length>4&&(e=Math.round(100*e)/100),e}}}},plugins:{tooltip:{mode:"interpolate",intersect:!1,enabled:!0,animation:!1,callbacks:{title:function(e,t){return e[0].element.x.toFixed(2)},label:function(e){return e.chart.data.datasets[e.datasetIndex].label+": "+e.element.y.toFixed(2)}}},zoom:{zoom:{wheel:{enabled:!0},pinch:{enabled:!1},drag:{enabled:!0,modifierKey:"ctrl"},mode:"xy"},pan:{enabled:!0,mode:"xy"},limits:{x:{min:-1,max:3e3},y:{min:-10,max:5e4}}},title:{display:!0,text:"Chart 1",font:{size:24}}}}}),T=new Chart(t,{type:"line",data:{datasets:[{label:"Nottingham heat",data:a,backgroundColor:["rgba(255, 99, 132, 0.2)"],borderColor:["rgba(255, 99, 132, 1)"],borderWidth:1,interpolate:!0}]},options:{fill:!1,lineTension:.1,scales:{y:{title:{display:!0,text:"Nottigham heat",font:{size:18}},type:"logarithmic",position:"bottom",ticks:{callback:function(e,t,n){return 1e6===e?"1 [MW/nm^2]":1e5===e?"100 [kW/nm^2]":1e4===e?"10 [kW/nm^2]":1e3===e?"1 [kW/nm^2]":100===e?"100 [W/nm^2]":10===e?"10 [W/nm^2]":1===e?"1 [W/nm^2]":.1===e?"100 [mW/nm^2]":.01===e?"10 [mW/nm^2]":.001===e?"1 [mW/nm^2]":1e-4===e?"0.1 [mW/nm^2]":1e-5===e?"0.01 [mW/nm^2]":1e-6===e?"1000 [nW/nm^2]":1e-7===e?"100 [nW/nm^2]":1e-8===e?"10 [nW/nm^2]":1e-9===e?"1 [nW/nm^2]":1e-10===e?"100 [pW/nm^2]":1e-11===e?"10 [pW/nm^2]":1e-12===e?"1 [pW/nm^2]":1e-13===e?"100 [fW/nm^2]":1e-14===e?"10 [fW/nm^2]":1e-15===e?"1 [fW/nm^2]":null}}},x:{title:{text:"Sweeping parameter",display:!0,font:{size:18}},type:"linear",position:"bottom",ticks:{callback:function(e,t,n){return String(e).length>4&&(e=Math.round(100*e)/100),e}}}},plugins:{tooltip:{mode:"interpolate",intersect:!1,enabled:!0},zoom:{zoom:{wheel:{enabled:!0},pinch:{enabled:!1},drag:{enabled:!0,modifierKey:"ctrl"},mode:"xy"},pan:{enabled:!0,mode:"xy"},limits:{x:{min:-1,max:3e3},y:{min:-10,max:5e4}}},title:{display:!0,text:"Chart 2",font:{size:24}}}}}),S=new Chart(n,{type:"line",data:{labels:[],datasets:[{label:"electron spectrum",data:[],backgroundColor:["rgba(255, 99, 132, 0.2)"],borderColor:["rgba(255, 99, 132, 1)"],borderWidth:1}]},options:{}})}(),e.on("calculatedEmission",e=>{console.log(e),function(e){let t=e.sweepParam,n=e.materialType,a,r=e.field,i=e.radius,l=e.work_function,o=e.temperature,s=e.metalEC,d=e.metalNH;e.metalES;let m=e.semiEC,u=e.semiNH;function c(e,t){if("1"==t.materialType)switch(t.sweepParam){case"field":e.options.plugins.title.text=`Radius: ${t.radius[0]} nm, Work Function: ${t.work_function[0]} eV, Temperature: ${t.temperature[0]} K`;break;case"radius":e.options.plugins.title.text=`Field: ${t.field[0]} V/nm, Work Function: ${t.work_function[0]} eV, Temperature: ${t.temperature[0]} K`;break;case"workFunction":e.options.plugins.title.text=`Field: ${t.field[0]} V/nm, Radius: ${t.radius[0]} nm, Temperature: ${t.temperature[0]} K`;break;case"temperature":e.options.plugins.title.text=`Field: ${t.field[0]} V/nm, Radius: ${t.radius[0]} nm, Work Function: ${t.work_function[0]} eV`}else switch(t.sweepParam){case"field":e.options.plugins.title.text=[`Radius: ${t.radius[0]} nm, Work Function: ${t.work_function[0]} eV, Temperature: ${t.temperature[0]} K, Ec: ${t.ec} eV`,`Ef: ${t.ef} eV, Eg: ${t.eg} eV, Me: ${t.me} m/me, Mp: ${t.mp} m/me`];break;case"radius":e.options.plugins.title.text=[`Field: ${t.field[0]} V/nm, Work Function: ${t.work_function[0]} eV, Temperature: ${t.temperature[0]} K, Ec: ${t.ec} eV`,`Ef: ${t.ef} eV, Eg: ${t.eg} eV, Me: ${t.me} m/me, Mp: ${t.mp} m/me`];break;case"workFunction":e.options.plugins.title.text=[`Field: ${t.field[0]} V/nm, Radius: ${t.radius[0]} nm, Temperature: ${t.temperature[0]} K, Ec: ${t.ec} eV`,`Ef: ${t.ef} eV, Eg: ${t.eg} eV, Me: ${t.me} m/me, Mp: ${t.mp} m/me`];break;case"temperature":e.options.plugins.title.text=[`Field: ${t.field[0]} V/nm, Radius: ${t.radius[0]} nm, Work Function: ${t.work_function[0]} eV, Ec: ${t.ec} eV`,`Ef: ${t.ef} eV, Eg: ${t.eg} eV, Me: ${t.me} m/me, Mp: ${t.mp} m/me`]}e.update()}function p(e,t){switch(t){case"field":e.options.scales.x.title.text="Field, [V/nm]",e.options.plugins.zoom.limits.x={min:bounds.field.min,max:bounds.field.max},e.update();break;case"radius":e.options.scales.x.title.text="Radius, [nm]",e.options.plugins.zoom.limits.x={min:bounds.radius.min,max:bounds.radius.max},e.update();break;case"workFunction":e.options.scales.x.title.text="Work Function, [eV]",e.options.plugins.zoom.limits.x={min:bounds.workFunction.min,max:bounds.workFunction.max},e.update();break;case"temperature":e.options.scales.x.title.text="Temperature, [K]",e.options.plugins.zoom.limits.x={min:bounds.temperature.min,max:bounds.temperature.max},e.update()}}function _(e,t){e.data.datasets.forEach(e=>{e.data=null}),e.update();let n=e.data.datasets[0];t.forEach(e=>{n.data.push(e)}),e.update()}e.semiES,function(){switch(t){case"field":a=r;break;case"radius":a=i;break;case"wf":a=l;break;case"temp":a=o}}(),function(){let t=[];if("1"==n)for(let r=0;r<a.length;r++)t.push({x:a[r],y:Math.abs(s[r])});else for(let i=0;i<a.length;i++)t.push({x:a[i],y:Math.abs(m[i])});console.log(t),M.resetZoom(),p(M,e.sweepParam),c(M,e),_(M,t)}(),function(){let t=[];if("1"==n)for(let r=0;r<a.length;r++)t.push({x:a[r],y:Math.abs(d[r])});else for(let i=0;i<a.length;i++)t.push({x:a[i],y:Math.abs(u[i])});T.resetZoom(),p(T,e.sweepParam),c(T,e),_(T,t)}()}(e),$("#loadingModal").modal("hide")})}let errorDivs=[];function updatePreselectSemiProperties(){let e=document.getElementById("preselectSemiProperties"),t=document.getElementById("ecParam"),n=document.getElementById("efParam"),a=document.getElementById("egParam"),r=document.getElementById("gammaSemiParam"),i=document.getElementById("meParam"),l=document.getElementById("mpParam"),o={1:["Si",1.12,.98,.49,4.61,4.05,5.17],2:["Ge",.66,1.64,.28,4.33,4,4.66],3:["GaAs",1.42,.067,.082,4.78,4.07,5.49]};switch(e.value){case"1":s(1);break;case"2":s(2);break;case"3":s(3)}function s(e){a.value=o[e][1],i.value=o[e][2],l.value=o[e][3],n.value=o[e][4],t.value=o[e][5],r.value=10}}function updatePropertiesPresets(){let e=document.getElementById("field_in"),t=document.getElementById("radius_in"),n=document.getElementById("wf_in"),a=document.getElementById("temperature_in"),r=document.getElementById("pickChangingVar");switch(r.value){case"1":e.placeholder="4.5, 7, 9.5, 13, 15.5",t.placeholder="50",n.placeholder="4.5",a.placeholder="300";break;case"2":e.placeholder="10",t.placeholder="50, 60, 70, 80, 90",n.placeholder="4.5",a.placeholder="300";break;case"4":e.placeholder="10",t.placeholder="50",n.placeholder="4, 5, 6, 7, 8",a.placeholder="300";break;case"5":e.placeholder="10",t.placeholder="50",n.placeholder="4.5",a.placeholder="273.15, 298.15, 300, 350, 500"}}function updateAdvancedMethods(){let e=document.getElementById("advancedModeToggle"),t=document.getElementById("pickMaterialType"),n=document.getElementById("advancedParametersSemi"),a=document.getElementById("advancedParametersMetal");!1==e.checked?(a.hidden=!0,n.hidden=!0):!0==e.checked&&(1==t.value?(a.hidden=!1,n.hidden=!0):2==t.value&&(a.hidden=!0,n.hidden=!1))}function autoGenerateValues(){let e,t,n,a=document.getElementById("pickChangingVar").value;try{e=parseFloat(document.getElementById("lowerBound").value),t=parseFloat(document.getElementById("upperBound").value),n=parseInt(document.getElementById("numberOfPointsInBounds").value)}catch(r){console.log(r)}let i=!0;if(i=function(){errorDivs.length>0&&(errorDivs.forEach(e=>{e.remove()}),errorDivs=[]);let n=!0;switch(a){case"1":(e<=bounds.field.min||t>=bounds.field.max)&&(addErrorDiv(`Field values must be in range of ${bounds.field.min} < x < ${bounds.field.max} V/nm`),n=!1);break;case"2":(e<=bounds.radius.min||t>=bounds.radius.max)&&(addErrorDiv(`Radius values must be in range of ${bounds.radius.min} < x < ${bounds.radius.max} nm`),n=!1);break;case"4":(e<=bounds.workFunction.min||t>=bounds.workFunction.max)&&(addErrorDiv(`Work Function values must be in range of ${bounds.workFunction.min} < x < ${bounds.workFunction.max} eV`),n=!1);break;case"5":(e<=bounds.temperature.min||t>=bounds.temperature.max)&&(addErrorDiv(`Temperature values must be in range of ${bounds.temperature.min} < x < ${bounds.temperature.max} K`),n=!1)}return n}()){let l=t-e,o=l/(n-1),s=[];for(let d=0;d<n;d++)0==d?s.push((e+d*o).toFixed(2)):s.push(" "+(e+d*o).toFixed(2));switch(a){case"1":document.getElementById("field_in").value=s;break;case"2":document.getElementById("radius_in").value=s;break;case"3":document.getElementById("gamma_in").value=s;break;case"4":document.getElementById("wf_in").value=s;break;case"5":document.getElementById("temperature_in").value=s}}}function updateWFName(){let e=document.getElementById("pickMaterialType");document.getElementById("pickChangingVar");let t=document.getElementById("wf_main"),n=document.getElementById("wfSelectId");document.getElementById("advancedModeToggleMainDiv");let a=document.getElementById("advancedModeToggle"),r=document.getElementById("advancedParametersSemi"),i=document.getElementById("advancedParametersMetal");1==e.value?(t.hidden=!1,n.hidden=!1,!0==a.checked?(i.hidden=!1,r.hidden=!0):(i.hidden=!0,r.hidden=!0)):2==e.value&&(t.hidden=!0,n.hidden=!0,!0==a.checked?(i.hidden=!0,r.hidden=!1):(i.hidden=!0,r.hidden=!0))}function updateAutoGenerateValuesDiv(){let e=document.getElementById("autoGeneratedInput"),t=document.getElementById("autoGenerateValuesToggle");!0==t.checked?e.hidden=!1:!1==t.checked&&(e.hidden=!0)}function addErrorDiv(e){console.log(e);let t=`
    <section class="container showcase alert alert-danger alert-dismissible my-auto animated bounceInLeft">
        <strong class="mx-2">Error!</strong> ${e}!
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </section>
    `,n=document.getElementById("TopBarView2"),a=document.createElement("div");a.innerHTML=t;let r=a.children[0];errorDivs.push(r),insertAfter(r,n)}main();const typeDict={0:"String",1:"Array",99:"Unknown"},separatorDict={0:".",1:",",2:" ",99:"Unknown"},multDict={0:"*",1:"e",99:"Unknown"},commaDict={0:",",1:".",99:"Unknown"};function processDataInput(e){let t="",n="",a=new Input(e);switch(0==a.type&&a.processString(),1==a.type&&a.processArray(),99==a.type&&a.processUnknownInput(),a.separator){case 0:t=".";break;case 1:t=",";break;case 2:t=" "}switch(a.comma){case 0:n=",";break;case 1:n="."}let r,i=[];if(r=0==a.type?a.data:beautifyResult(a.data.split(t)),","==n)for(let l=0;l<r.length;l++)r[l]=r[l].replace(n,".");return 99==r.separator?i.push(parseFloat(r)):(beautifyResult(r=r.split(separatorDict[a.separator])),r.forEach(e=>{i.push(parseFloat(e))})),i}class Input{constructor(e){this.data=e,this.type=getTypeOfInput(e),this.separator=getSeparator(e),this.mult=getMult(e),this.comma=getComma(e)}processString(){this.separator,this.comma}processArray(){this.data=this.data.slice(1,-1),this.processString()}processUnknownInput(){addErrorDiv("One of the input lines has a data of unknown type! Check console for more info"),console.log("Unknown data: "),console.log(this)}logProperties(){console.log(this)}}function getTypeOfInput(e){return"["==e[0]?1:isNaN(e[0])?"-"==e[0]?0:99:0}function getMult(e){return e.includes("*",1)?0:e.includes("e",1)?1:99}function getComma(e){if(1==getSeparator(e)){if(e.includes("."))return 1}else if(0==getSeparator(e)){if(e.includes(","))return 0}else if(2==getSeparator(e)){if(e.includes(","))return 0;if(e.includes("."))return 1}return 99}function getSeparator(e){let t=getMult(e);if(99!=t){if(0==t){t="*";let n=e.indexOf(t);for(let a=n;a>0;a--)if(isNaN(e[a])){if("."==e[a])return 0;if(","==e[a])return 1}}else if(1==t){t="e";let r=e.indexOf(t);for(let i=r;i<e.length;i++)if(isNaN(e[i])){if("."==e[i])return 0;if(","==e[i])return 1}}}else{if(99!=t)return 99;let l=e.indexOf(" ",2);return -1==l?1:"."==e[l-1]?0:","==e[l-1]?1:isNaN(e[l-1])?99:2}}function beautifyResult(e){for(let t=0;t<e.length;t++)endsWith(e[t]," ")&&(e[t]=e[t].slice(0,-1))," "==e[t][0]&&(e[t]=e[t].slice(1));return e}function endsWith(e,t){return -1!==e.indexOf(t,e.length-t.length)}function insertAfter(e,t){t.parentNode.insertBefore(e,t.nextSibling)}